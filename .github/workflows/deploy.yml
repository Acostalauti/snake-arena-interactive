name: CD - Deploy to Render

on:
  push:
    branches: [ main ]
  workflow_run:
    workflows: ["CI - Run Tests"]
    types:
      - completed
    branches: [ main ]

jobs:
  deploy:
    name: Deploy to Render
    runs-on: ubuntu-latest
    
    # Only run if the CI workflow completed successfully
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'push' }}
    
    steps:
      - name: Trigger Render Deployment
        run: |
          if [ -z "${{ secrets.RENDER_DEPLOY_HOOK_URL }}" ]; then
            echo "‚ö†Ô∏è  WARNING: RENDER_DEPLOY_HOOK_URL secret is not set"
            echo "Please configure the deploy hook URL in your GitHub repository secrets"
            echo "See: https://github.com/${{ github.repository }}/settings/secrets/actions"
            exit 1
          fi
          
          echo "üöÄ Triggering deployment to Render..."
          curl -X POST "${{ secrets.RENDER_DEPLOY_HOOK_URL }}"
          echo ""
          echo "‚úÖ Deployment triggered successfully!"
          echo "Monitor deployment progress at: https://dashboard.render.com"
